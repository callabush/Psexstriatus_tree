---
title: "Psexstriatus_tree"
author: "Calla Bush St George"
date: "`r Sys.Date()`"
output:
  html_document: 
    code_folding: show
    theme: spacelab
    highlight: pygments
    keep_md: no
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
      toc_depth: 3
  keep_md: true  
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      fig.align = "center",
                      fig.path = "../figures/") #Send any figure output to this folder
```

## Before you start

### Set my seed
```{r set seed}
# Any number can be chose
set.seed(567890)
```

### Load Libraries

```{r load-libraries}
# Efficient package loading with pacman 
# Don't forget to install pacman and DT if you don't have it yet. :) 
#if (!require("BiocManager", quietly = TRUE))
 #   install.packages("BiocManager")
#BiocManager::install("ggtree")
#if (!requireNamespace("remotes", quietly = TRUE)) {
#  install.packages("remotes")
#}
#remotes::install_github("thomas-neitmann/mdthemes", upgrade = "never")
pacman::p_load(tidyverse, ggtree, ggtext, mdthemes,phyloseq, phytools,
               install = FALSE)
```

## Load Tree

```{r load-tree}
# Tree is RAxML in newick format
tree <- 
  read.tree("data/2024_4_12_rooted.newick")
tree
```

# View tree

```{r view-tree}
# build a ggplot with a geom_tree
tree_df <-
  ggplot(tree) + geom_tree() + theme_tree()
tree_df
# add a scale
tree_scale_df <-
  ggtree(tree) + geom_treescale()
tree_scale_df

# add node points
tree_scale_df + geom_nodepoint()

# add tip points
tree_scale_df + geom_tippoint()

# Label the tips
tree_scale_df + geom_tiplab(size = 2)

# Add title
tree_scale_df +
  labs(title = "*P. sexstriatus* ASV and Clone Tree") +
  theme(title = ggtext::element_markdown())

# Add node numbers
tree_scale_df + geom_text(aes(label = node), hjust = 0.5, vjust = -0.3,
                          size = 2)

# Collapse tree
collapse_239 <- tree_scale_df %>% collapse(node=239) + 
  geom_point2(aes(subset=(node==239)), shape=21, size=2, fill='green')
collapse_239

collapse_239 +  geom_text(aes(label = node), hjust = 0.5, vjust = -0.3,
                          size = 2)
collapse_239 + geom_tiplab(size = 2)

collapse_114 <-
  collapse_239 %>% collapse(node=114) + 
  geom_point2(aes(subset=(node==114)), shape=21, size=2, fill='green')

collapse_266 <-
  collapse_114 %>% collapse(node=266) + 
  geom_point2(aes(subset=(node==266)), shape=21, size=2, fill='green')

collapse_266 %>% collapse(node=263) + 
  geom_point2(aes(subset=(node==263)), shape=21, size=2, fill='green')

```

## Help page 
 https://yulab-smu.top/treedata-book/chapter6.html


